require.config({baseUrl:"./js",paths:{jquery:"lib/jQuery",scroll:"lib/iscroll",modal:"lib/jquery.simplemodal",utility:"entry/utility/utility",prompt:"entry/function/prompt"}}),require(["jquery","utility","scroll","prompt"],function(e,t,n,r){function a(e,t,n){var r=Number(e.html());t.html(Number(n)*r)}function f(e,t){var n=0;for(var r=0;r<e.length;r++)n+=Number(e.eq(r).html()),console.log(1);t.html(n)}var r=new r.Prompt({prompt:e(".prompt")}),i={checkout:"../index.php/api/createOrder",center:"./order",back:""},s=bindScroll(e(".container")),o=e(".gross-price"),u=e(".total-price");setTimeout(function(){f(o,u)},1e3),e(".pages").on("change blur",function(){var t=e(this).parent().parent(),n=t.find(".single"),i=t.find(".gross-price"),s=/^\d+$/,l=e(this).val().trim();s.test(l)?Number(l)===0?(r.changeInfo("小朋友不可以是0哦~~"),e(this).val(1)):(a(n,i,l),f(o,u)):(r.changeInfo("输入的份数必须为整数且大于0"),e(this).val(1))}),e(".page-size").on("change",function(){var t,n=e(this).parent().parent(),r=n.find(".single"),i=n.find(".gross-price"),s=n.find(".pages").val();switch(e(this).val()){case"A1":t=3;break;case"A2":t=2.5;break;case"A3":t=2;break;case"A4":t=1.5}r.html(t),a(r,i,s),f(o,u)});var l={$delete_btns:e(".delete-btns"),$tbody:e("tbody"),deleteItem:function(n){var s=n.parents("tr"),o=n.attr("data-mark"),u=this;e.ajax({url:i.remove,type:"POST",data:{mark:o}}).then(function(e){e.success?(r.changeInfo("删除成功!"),s.detach()):r.changeInfo("删除失败!")})},removeRow:function(n){var r=confirm("确认删除吗？");if(r){var a=n.attr("data-mark"),l=-1;FileMarks.forEach(function(e,t){Number(a)===Number(t)&&(l=t)}),FileMarks.splice(index,1),n.parents("tr").detach(),o=e(".gross-price"),f(o,u),setTimeout(function(){s.forEach(function(e){e.refresh()})},0),e.ajax({url:i.delete}).done()}},init:function(){var n=this;this.$tbody.on("click",function(t){var r=e(t.target);r.hasClass("delete-btns")&&n.removeRow(r)})}};l.init();var c={$plus:e(".plus"),$minus:e(".minus"),getInput:function(t){return t.siblings("input")},addText:function(t){var n=this.getInput(t);n.val(Number(n.val())+1)},decrease:function(t){var n=this.getInput(t);n.val(Number(n.val())-1)},init:function(){var n=this;this.$plus.on("click",function(){n.addText(e(this)),e(".pages").trigger("change")}),this.$minus.on("click",function(){n.decrease(e(this)),e(".pages").trigger("change")}),e(".pages").trigger("change")}};c.init(),e('input[name="method"]').on("change",function(t){var n=e(".pick"),r=e(".deliver"),i=e(this).val();i==="到店自取"?n.show().siblings().hide():i==="送货上门"&&r.show().siblings().hide()});var h={checkout:e(".clearing"),bills:e("tbody tr"),Files:[],getInfo:function(){var n=this,r=[];return this.bills.each(function(){var t=e(this).find(".file-name").text(),n=e(this).find('[role="share"] input[value="yes"]').is(":checked"),i=e(this).find('[role="page"] input[value="single"]').is(":checked")?"single":"both",s=e(this).find('[role="direction"] input[value="column"]').is(":checked")?"column":"row",o=e(this).find('[role="direction"] select'),u=-1,a=e(this).find('[role="size"] select').val(),f=e(this).find('[role="copies"] input').val(),l=e(this).find('[role="delete"] a').attr("data-mark");if(o.length?!0:!1)u=Number(o.val());var c={name:t,share:n,side:i,direction:s,pptNum:u,size:a,copies:f,mark:l};r.push(c)}),r},init:function(){var n=this;this.checkout.on("click",function(){n.Files=n.getInfo();var t=e('input[name="method"]:checked').val(),s=u.html();info={};if(t==null||t=="")r.changeInfo("请选择收货方式!");else{if(t==="到店自取"){var o=e(".print-shop").val();info={method:t,store:o,price:s}}else if(t==="送货上门"){var a=e(".school-area").val(),f=e(".building").val(),l=e(".phone").val().trim(),c=e(".address").val().trim(),h={phone:/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,mobile:/^(\(\d{3,4}\)|\d{3,4}-)?\d{7,8}$/};!h.mobile.test(l)&&!h.phone.test(l)?r.changeInfo("号码输入有误"):c==""?r.changeInfo("地址不能为空!"):info={method:t,school_area:a,building:f,phone_text:l,address_text:c,price:s}}e(this).addClass("sending").prop("disabled",!0),e.ajax({url:i.checkout,success:function(n){n.success?window.location.href=i.center:(r.changeInfo(n.msg),e(this).removeClass("sending").prop("disabled",!1))}})}})}};h.init(),e(".upload,.add").on("click",function(){window.location.href="./upload"})});