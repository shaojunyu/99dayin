require.config({baseUrl:"./js",paths:{jquery:"lib/jQuery",scroll:"lib/iscroll",utility:"entry/utility/utility",prompt:"entry/function/prompt",enroll:"entry/function/enroll",ping:"lib/pingpp-pc",modal:"lib/jquery.simplemodal"}}),require(["jquery","scroll","utility","prompt","enroll","modal","ping"],function(e,t,n,r,i,s){function u(t,n){t.css("display")!=="block"&&(e.modal.close(),openModal(t,n))}function a(e){e.css("display")==="none"?e.show():e.hide()}function f(t){t.on("focus",function(){e(this).removeClass("error"),e(this).attr("data-iden","1")})}var o=bindScroll(e(".container"));r=new r.Prompt({prompt:e(".prompt")});var l={delteOrd:"",addPrint:"",getToken:"",changeInfo:"",sendImg:"",promptPs:"",username:"",createPay:"../index.php/api/createPay"},c={pre:e(".order-content"),history:e(".his-content"),order_btn:e(".orders-choice"),checkout_modal:e(".paying"),deleteOrder:function(t){var n=t.parents("li"),i=t.attr("data-order"),s=!1,u=-1;Orders.forEach(function(e,t){Number(e.order)===Number(i)&&(s=!0,u=t)}),s&&Orders.splice(u,1),n.detach(),o.forEach(function(e){e.refresh()}),sendAjax({url:l.delteOrd,data:{Orders:Orders},success:function(t){t.success||r.changeInfo("您的网络又问题，请重新删除~")}})},checkout:function(t){var n=t.attr("data-seq")},init:function(){var n=this;this.pre.on("click",function(t){var r=e(t.target),i=window.open();if(r.hasClass("cancel")){var s=confirm("确认取消订单吗?");s&&n.deleteOrder(r)}else if(r.hasClass("go-pay")){var o=r.parents("li"),u=o.find(".order-num").text(),a=o.find(".money").text();openModal(n.checkout_modal,!1),e.ajax({url:l.createPay,dataType:"JSON"}).done(function(e){i.location.href="./user/pay?orderId="+e.id,openModal(n.checkout_modal,!1),n.checkout_modal.attr("data-num",u)})}}),this.order_btn.on("click",function(t){var n=e(t.target),r=e(".pre-order"),i=e(".his-order");n.hasClass("pre-order-btn")?(changeShow(r,i),n.addClass("active").siblings().removeClass("active"),o.forEach(function(e){e.refresh()})):n.hasClass("historic-order-btn")&&(changeShow(i,r),n.addClass("active").siblings().removeClass("active"),o.forEach(function(e){e.refresh()}))}),this.history.on("clicl",function(t){var n=e(t.target);if(n.hasClass("add-print")){var i=Number(n.attr("data-seq"));sendAjax({url:l.addPrint,data:{history:HisOrder[i]},success:function(t){t.success?window.location.href=t.url:r.changeInfo("对不起你的订单信息已经失效~~")}})}})}};c.init();var h=[/^[\u4e00-\u9fa5A-Za-z0-9-_]*$/,/^[\u4e00-\u9fa5A-Za-z0-9-_]{4,12}$/],p=["姓名只能输入中英文，数字，下划线和减号!","用户名输入长度只能在4~12位!"],d=[/^[a-zA-Z]\w*$/,/^[a-zA-Z]\w{5,15}$/],v=["密码以字母开头，只能包含字母,数字,下划线!","密码输入长度只能在6~16位!"],m=[/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/],g=["请输入正确手机号!"],y=[/^[\u4e00-\u9fa5]{0,}$/],b=["输入不能包含非法字符!"],w=[/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/],E=[" 邮箱格式不正确!"],S={content:e(".content"),authentic:e(".authentic-page"),changePs:e(".change-ps"),upload:e(".upload"),confir:e(".confirm-btn"),promptPs:e(".prompt-ps"),oldPs:e(".old-ps"),newPs:e(".new-ps"),confir:e(".confir-ps"),edit_btn:e(".edit-info"),changeInfo:e(".change-info"),change_btn:e(".change-btn"),confirm_code:e(".confir-code"),obtain_code:e(".get-code"),name:e(".name"),phone:e(".phone"),CF_code:e(".confir-code"),email:e(".email"),address:e(".address"),showImg:function(t,n){var i=new FileReader;if(!/image\/\w+/.test(t.type))return r.changeInfo("上传的不是图片类型!"),!1;i.onload=function(e){n.attr("src",e.target.result)},i.readAsDataURL(t)},init:function(){var n=this;this.content.on("click",function(t){var r=e(t.target);r.hasClass("authentic-btn")?a(n.authentic):r.hasClass("change-ps-btn")?a(n.changePs):r.hasClass("back")&&(console.log(r.parents("left-part")),r.parents(".left-part").hide())}),this.upload.on("change",function(){if(!this.files.length)return!1;var t=this.files[0],r=e(this).parent().next();n.showImg(t,r)}),this.confir.on("click",function(){var t=e("upload-img img"),i=!1,s=[];t.each(function(){i=!0;var t=e(this).attr("src"),n=e(this).attr("data-type");console.log(1);if(e(this).attr("src")==""||e(this).attr("src")==null)console.log(1),i=!1;s.push({img:t,type:n})}),console.log(i);if(!i)return r.changeInfo("请先上传图片!"),!1;sendAjax({url:l.sendImg,data:{file:s},success:function(i){i.success?(changeShow(e(".authenticating"),e(".authentic-btn")),r.changeInfo("上传成功，请耐心等待!"),n.authentic.hide()):r.changeInfo("上传失败，请注意网络情况!")}})}),this.promptPs.on("click",function(){var e=n.oldPs.val(),t=n.newPs.val(),i=n.confir.val(),s=/^[a-zA-Z]\w*$/;e==""||e==null||t==""||t==null||i==null||i==""?r.changeInfo("输入不能为空,请先输入!"):s.test(t)?r.changeInfo("密码以字母开头，只能包含字母,数字,下划线!"):e===i?r.changeInfo("两次密码输入不一致!"):sendAjax({url:l.promptPs,data:{oldPs:e,newPs:t},success:function(t){t.success&&(n.promptPs.parents(".change-ps").hide(),r.changeInfo("密码修改成功!"))}})}),this.edit_btn.on("click",function(){a(n.changeInfo)});var i="";this.obtain_code.on("click",function(){e(this).addClass("sending");var t=n.phone.val(),s=n.phone.attr("data-iden")==="1"?!0:!1;if(!s)return r.changeInfo("请输入正确手机号!"),!1;sendAjax({url:l.getToken,data:{phone:t},success:function(n){n.success?i=n.msg:e(this).removeClass("sending")}})}),this.confirm_code.on("blur",function(){var t=e(this).val();t==""||t==null?(r.changeInfo("验证码不能为空"),n.confirm_code.addClass("error")):i===t?(n.confirm_code.attr("data-iden","1"),n.confirm_code.removeClass("error")):(r.changeInfo("验证码输入不正确!"),n.confirm_code.attr("data-iden","0"),n.confirm_code.addClass("error"))}),f(n.confirm_code),this.name.enroll({reg:h,msg:p,override:!0,url:l.username}),this.phone.enroll({reg:m,msg:g}),this.email.enroll({reg:w,msg:E}),this.address.enroll({}),this.change_btn.on("click",function(){var e=n.name.val(),t=n.phone.val(),i=n.email.val(),s=n.address.val(),o=n.confirm_code.val(),u=n.name.attr("data-iden")==="1"?!0:!1;u?(n.change_btn.addClass("sending"),sendAjax({url:l.changeInfo,data:{name:e,phone:t,email:i,address:s,confirm:o},beforeSend:function(){n.change_btn.addClass("sending")},success:function(t){t.success?(r.changeInfo("信息修改成功,请重新登录!"),n.change_btn.parents(".left-part").hide()):(r.changeInfo("信息修改失败，请再次尝试"),n.change_btn.removeClass("sending"))}})):r.changeInfo("您的部分信息录入不正确!")})}};S.init();var x={pay:e(".paying"),close:e(".close"),paying_btn:e(".paying-btn button"),all_num:e(".order-num"),deleteOrder:function(t){var n=t.parents("li"),i=t.attr("data-order"),s=!1,u=-1;Orders.forEach(function(e,t){Number(e.order)===Number(i)&&(s=!0,u=t)}),s&&Orders.splice(u,1),n.detach(),o.forEach(function(e){e.refresh()}),sendAjax({url:l.delteOrd,data:{Orders:Orders},success:function(t){t.success||r.changeInfo("您的网络又问题，请重新删除~")}})},checkOrder:function(){var n=this.pay.attr("data-num"),i="";e.ajax({url:l,data:{num:n},success:function(t){t.success?(r.changeInfo("您的支付成功，请稍等订单消息~~"),setTimeout(function(){window.location.href="./"},1e3)):r.changeInfo("sorry~~您的订单支付不成功，请重新支付")}})},init:function(){var t=this;this.close.on("click",this.checkOrder)}};x.init()});