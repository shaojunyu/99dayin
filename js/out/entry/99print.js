require.config({baseUrl:"./js",paths:{jquery:"lib/jQuery",scroll:"entry/function/scroll",modal:"lib/jquery.simplemodal",utility:"entry/utility/utility",prompt:"entry/function/prompt",enroll:"entry/function/enroll",SMS:"https://cdn1.lncld.net/static/js/av-mini-0.6.1.js",md5:"lib/spark-md5.min",encryption:"entry/function/encryption"}}),require(["jquery","scroll","modal","prompt","enroll","encryption","utility"],function(e,t,n,r,i,s){function o(t,n){t.css("display")!=="block"&&(e.modal.close(),openModal(t,n))}function f(e,t){e.addClass(t).siblings().removeClass(t)}var t=new t.ScrollPage,r=new r.Prompt({prompt:e(".prompt")});e.ajaxSetup({dataType:"JSON"}),e("#down-arrow").on("click",function(){t.moveDown()}),e(".back-top").on("click",function(){t.moveUp()});var u=e("#login-frame"),a=e("#signin-frame");e("body").on("click",function(t){var n=e(t.target),r=n.parent();n.hasClass("login-btn")?o(u,!0):n.hasClass("signin-btn")?(console.log(1),o(a,!0)):n.hasClass("user-login")?f(n,"active"):n.hasClass("store-login")?f(n,"active"):r.hasClass("store-login")?f(r,"active"):n.hasClass("user-login")?f(n,"active"):r.hasClass("user-login")&&f(r,"active")}),e(".user-login,.store-login").on("click",function(){f(e(this),"active")});var l={login:s.Encryption("index.php/api/login"),sigin:s.Encryption("index.php/api/signup"),Linklogin:"",username:s.Encryption("index.php/api/verifySmsCode"),CF_url:s.Encryption("index.php/api/sendSmsCode"),upload:"",logout:s.Encryption("index.php/api/logout")},c={$username:e(".login-account"),$ps:e(".login-ps"),$iden:e(".login-choice>div.active"),title:e(".title-btn"),detail:e(".detail-btn"),print_btn:e(".print-btn"),getText:function(t){return t.val()},getIden:function(){var t=this.$iden;return t.hasClass("user-login")?0:1},linkSuccess:function(t){t.success},afterLogin:function(t){this.print_btn.attr("href",l.upload),this.title.html('<a class="name">'+t+"/a>")},beforeLogin:function(){this.print_btn.attr("href","javascript:void(0)"),this.title.html('<span class="login" id="login" data-content="登录">登录</span><span>|</span><span class="signin" id="signin" data-content="注册">注册</span>')},init:function(){var n=this;e(".login-btn").on("click",function(){var e=n.getText(n.$username),t=n.getText(n.$ps),i=n.getIden();sendAjax({url:l.login,dataType:"json",data:{username:e,ps:t},success:function(t){t.success?(window.location.href="./",console.log(1)):r.changeInfo(t.msg)}})}),e(".QQ-login").on("click",function(){sendAjax({url:l.Linklogin,data:{login_method:"QQ"},success:n.linkSuccess})}),this.title.on("click",function(t){var r=e(t.target);r.hasClass("name")?toggleShow(n.detail):r.hasClass("login")?o(u,!0):r.hasClass("signin")&&o(a,!1)}),this.detail.on("click",function(t){var n=e(t.target);n.hasClass("logout")&&sendAjax({url:l.logout,success:function(t){t.success&&(window.location.href="./")}})}),this.print_btn.on("click",function(){e(this).attr("data-log")==0&&o(u,!0)})}};c.init();var h=[/^[\u4e00-\u9fa5A-Za-z0-9-_]*$/,/^[\u4e00-\u9fa5A-Za-z0-9-_]{4,12}$/],p=["用户名只能输入中英文，数字，下划线和减号!","用户名输入长度只能在4~12位!"],d=[/^[a-zA-Z]\w*$/,/^[a-zA-Z]\w{5,15}$/],v=["密码以字母开头，只能包含字母,数字,下划线!","密码输入长度只能在6~16位!"],m=[/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/],g=["请输入正确手机号!"],y=[/^[\u4e00-\u9fa5]{0,}$/],b=["输入不能包含非法字符!"],w={$username:e(".username"),$pwd:e(".ps"),$CF_pwd:e(".confir-ps"),$phone:e(".phone"),$security_code:e(".secu-code"),$college:e(".college"),$enroll_btn:e(".enroll"),$confir_btn:e(".comfir-btn"),CF_code:"",sendCode:function(){},checkQR:function(){var n=this;this.$security_code.on("blur",function(){var t=e(this).val(),i=n.$phone.val();e.ajax({url:l.username,type:"POST",dataType:"json",contentType:"application/json",data:{mobilePhoneNumber:i,smsCode:t}}).done(function(t){t.success?(e(this).removeClass("error"),e(this).attr("data-iden",1)):(r.changeInfo("验证码输入错误!"),e(this).addClass("error"),e(this).attr("data-iden",0))})}).inputFocus()},addDetect:function(){var n=this;this.$username.enroll({reg:h,msg:p}),this.$pwd.enroll({reg:d,msg:v}),this.$phone.enroll({reg:m,msg:g}),this.$CF_pwd.inputFocus().on("blur",function(){var t=n.$pwd.val(),i=e(this).val();t!==i?(r.changeInfo("两次密码输入不一致!"),e(this).addClass("error"),e(this).attr("data-iden","0")):(e(this).removeClass("error"),e(this).attr("data-iden","1"))}),e(".comfir-btn").on("click",function(){var t=e(this),i=n.$phone.val();sendAjax({url:l.CF_url,data:{phone:i},beforeSend:function(){t.addClass("sending").attr("disabled","disabled")},success:function(n){n.success||(t.removeClass("sending").removeAttr("disabled","disabled"),r.changeInfo(n.msg))}})})},send:function(){var n=this;this.$enroll_btn.on("click",function(){var t=[],i=n.$username.val(),s=n.$pwd.val(),o=n.$phone.val(),u=n.$college.val(),a=n.$security_code.val();e(".username,.ps,.confir-ps,.phone,.secu-code,.college,.enroll").each(function(){t.push(e(this).attr("data-iden"))});for(var f=0;f<t.length;f++)if(t[f]==0)return r.changeInfo("信息未填写完整!"),!1;sendAjax({url:l.sigin,data:{username:i,password:s,mobilePhoneNumber:o,college:u},success:function(t){t.success?window.location.href="./":r.changeInfo("注册失败!")}})})},init:function(){this.addDetect(),this.send(),this.checkQR()}};w.init()});