function getStreamFromBuffer(e){var t=new Stream.Readable;return t._read=function(){t.push(new Buffer(e)),t._read=t.push.bind(t,null)},t}var insert=require("../"),expect=require("chai").expect,File=require("gulp-util").File;Stream=require("readable-stream"),describe("Append",function(){it("let pass null files through",function(e){var t=insert.append(" world"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:null});t.on("data",function(t){expect(t.contents).to.be.equal(null),e()}),t.write(n),t.end()}),it("appends the string onto the file in buffer mode",function(e){var t=insert.append(" world"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer("Hello")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal("Hello world"),e()}),t.write(n),t.end()}),it("appends the file.path onto the file in buffer mode",function(e){var t=insert.append(function(e){return e.path}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer("Hello")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal("Hello"+t.path),e()}),t.write(n),t.end()}),it("appends the string onto the file in stream mode",function(e){var t=insert.append(" world"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:getStreamFromBuffer(new Buffer("Hello"))});t.on("data",function(t){var n=[];t.contents.on("data",function(e){n.push(e)}),t.contents.on("end",function(){expect(Buffer.concat(n).toString()).to.be.equal("Hello world"),e()})}),t.write(n),t.end()})}),describe("Prepend",function(){it("let pass null files through",function(e){var t=insert.prepend("Hello"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:null});t.on("data",function(t){expect(t.contents).to.be.equal(null),e()}),t.write(n),t.end()}),it("prepends the string onto the file in buffer mode",function(e){var t=insert.prepend("Hello"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer(" world")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal("Hello world"),e()}),t.write(n),t.end()}),it("prepends the file.path onto the file in buffer mode",function(e){var t=insert.prepend(function(e){return e.path}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer(" world")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal(t.path+" world"),e()}),t.write(n),t.end()}),it("prepends the string onto the file in stream mode",function(e){var t=insert.prepend("Hello"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:getStreamFromBuffer(new Buffer(" world"))});t.on("data",function(t){var n=[];t.contents.on("data",function(e){n.push(e)}),t.contents.on("end",function(){expect(Buffer.concat(n).toString()).to.be.equal("Hello world"),e()})}),t.write(n),t.end()})}),describe("Wrap",function(){it("let pass null files through",function(e){var t=insert.wrap("Hello ","!"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:null});t.on("data",function(t){expect(t.contents).to.be.equal(null),e()}),t.write(n),t.end()}),it("prepends the first argument and appends the second argument in buffer mode",function(e){var t=insert.wrap("Hello ","!"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer("world")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal("Hello world!"),e()}),t.write(n),t.end()}),it("prepends file.base and file.path in buffer mode",function(e){var t=insert.wrap(function(e){return e.base},function(e){return e.path}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer("world")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal(t.base+"world"+t.path),e()}),t.write(n),t.end()}),it("prepends the first argument and appends the second argument in stream mode",function(e){var t=insert.wrap("Hello ","!"),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:getStreamFromBuffer(new Buffer("world"))});t.on("data",function(t){var n=[];t.contents.on("data",function(e){n.push(e)}),t.contents.on("end",function(){expect(Buffer.concat(n).toString()).to.be.equal("Hello world!"),e()})}),t.write(n),t.end()})}),describe("Transform",function(){it("let pass null files through",function(e){var t=insert.transform(function(e){return e.toUpperCase()}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:null});t.on("data",function(t){expect(t.contents).to.be.equal(null),e()}),t.write(n),t.end()}),it("applys the function to the string in buffer mode",function(e){var t=insert.transform(function(e){return e.toUpperCase()}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer("hello world")});t.on("data",function(t){expect(t.contents.toString()).to.be.equal("HELLO WORLD"),e()}),t.write(n),t.end()}),it("applys the function to the string in stream mode",function(e){var t=insert.transform(function(e){return e.toUpperCase()}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:getStreamFromBuffer(new Buffer("hello world"))});t.on("data",function(t){var n=[];t.contents.on("data",function(e){n.push(e)}),t.contents.on("end",function(){expect(Buffer.concat(n).toString()).to.be.equal("HELLO WORLD"),e()})}),t.write(n),t.end()}),it("passes the vinyl file object as second parameter in buffer mode",function(e){var t=insert.transform(function(e,t){var n=[];return n.push(t.cwd),n.push(t.base),n.push(t.path),n.push(e),n.join("\n")}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:new Buffer("hello world")});t.on("data",function(t){var n=t.contents.toString().split("\n");expect(n.length).to.be.equal(4),expect(n[0]).to.be.equal(__dirname),expect(n[1]).to.be.equal(__dirname+"test"),expect(n[2]).to.be.equal(__dirname+"test/file.js"),expect(n[3]).to.be.equal("hello world"),e()}),t.write(n),t.end()}),it("passes the vinyl file object as second parameter in stream mode",function(e){var t=insert.transform(function(e,t){var n=[];return n.push(t.cwd),n.push(t.base),n.push(t.path),n.push(e),n.join("\n")}),n=new File({cwd:__dirname,base:__dirname+"test",path:__dirname+"test/file.js",contents:getStreamFromBuffer(new Buffer("hello world"))});t.on("data",function(t){var n=[];t.contents.on("data",function(e){n.push(e)}),t.contents.on("end",function(){var t=Buffer.concat(n).toString().split("\n");expect(t.length).to.be.equal(4),expect(t[0]).to.be.equal(__dirname),expect(t[1]).to.be.equal(__dirname+"test"),expect(t[2]).to.be.equal(__dirname+"test/file.js"),expect(t[3]).to.be.equal("hello world"),e()})}),t.write(n),t.end()})});