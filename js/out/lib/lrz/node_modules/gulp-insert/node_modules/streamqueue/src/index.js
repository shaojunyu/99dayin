function streamInstanceOf(e){var t=[].slice(arguments,1),n;if(e instanceof Stream||e instanceof PlatformStream){while(t.length){n=arg.pop();if(!(e instanceof Stream[n]||"undefined"===PlatformStream[n]||e instanceof PlatformStream[n]))return!1}return!0}return!1}function StreamQueue(e){e=e||{};if(!(this instanceof StreamQueue))return new(StreamQueue.bind.apply(StreamQueue,[StreamQueue].concat([].slice.call(arguments,0))));this._pauseFlowingStream=!0,this._resumeFlowingStream=!0,!streamInstanceOf(e)&&"function"!=typeof e&&("boolean"==typeof e.pauseFlowingStream&&(this._pauseFlowingStream=e.pauseFlowingStream,delete e.pauseFlowingStream),"boolean"==typeof e.resumeFlowingStream&&(this._resumeFlowingStream=e.resumeFlowingStream,delete e.resumeFlowingStream)),Stream.PassThrough.call(this,streamInstanceOf(e)||"function"==typeof e?undefined:e),this._streams=[],this._running=!1,this._ending=!1,this._objectMode=e.objectMode||!1,(arguments.length>1||streamInstanceOf(e)||"function"==typeof e)&&this.done.apply(this,[].slice.call(arguments,streamInstanceOf(e)||"function"==typeof e?0:1))}var PlatformStream=require("stream"),Stream=require("readable-stream"),util=require("util");util.inherits(StreamQueue,Stream.PassThrough),StreamQueue.prototype.queue=function(){var e=[].slice.call(arguments,0),t=this;if(this._ending)throw new Error("Cannot add more streams to the queue.");return e=e.map(function(e){function n(e){return e.on("error",function(e){t.emit("error",e)}),"undefined"==typeof e._readableState&&(e=(new Stream.Readable({objectMode:t._objectMode})).wrap(e)),this._pauseFlowingStream&&e._readableState.flowing&&e.pause(),e}return"function"==typeof e?function(){return n(e())}:n(e)}),this._streams=this._streams.length?this._streams.concat(e):e,this._running||(this._running=!0,this._pipeNextStream()),this},StreamQueue.prototype._pipeNextStream=function(){if(!this._streams.length){this._ending?this.emit("end"):this._running=!1;return}var e=this._streams.shift();"function"==typeof e&&(e=e()),this._resumeFlowingStream&&e._readableState.flowing&&e.resume(),e.once("end",this._pipeNextStream.bind(this)),e.pipe(this,{end:!1})},StreamQueue.prototype.done=function(){if(this._ending)throw new Error("The queue is already ending.");return arguments.length&&this.queue.apply(this,arguments),this._ending=!0,this._running||this.emit("end"),this},Object.defineProperty(StreamQueue.prototype,"length",{get:function(){return this._streams.length+(this._running?1:0)}}),module.exports=StreamQueue;